FROM node:22.14.0

WORKDIR /app

RUN corepack enable && corepack prepare pnpm@latest --activate
RUN npm config set registry https://registry.npmjs.org

COPY package.json pnpm-lock.yaml ./
RUN pnpm install --frozen-lockfile

COPY . .

# Adicionei o comando de migra√ß√£o
RUN echo "‚è≥ Rodando migra√ß√µes..." && pnpm drizzle-kit generate:mysql
RUN echo "üî® Buildando aplica√ß√£o..." && pnpm build

EXPOSE 3000

CMD ["pnpm", "start"]